<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AP Reviewer - Sean Everett Beraquit (Interactive)</title>

  <!-- ✅ Same core style stack as your CLVE/Science reviewer -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2d2a6a2a2.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --paper:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --soft:#f8fafc;
      --good:#16a34a;
      --bad:#dc2626;
      --accent:#b45309; /* warm accent similar to your book tone */
    }

    body{
      font-family: 'Roboto', sans-serif;
      background: #f3f4f6;
      color: var(--ink);
    }

    .paper{
      max-width: 980px;
      margin: 18px auto;
      background: var(--paper);
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      overflow: hidden;
    }

    .paper-header{
      padding: 18px 18px 14px;
      background: linear-gradient(0deg, #fff, #fff5e6);
      border-bottom: 1px solid var(--line);
    }

    .badge-subject{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid #fde68a;
      color: #92400e;
      font-weight: 700;
      font-size: .9rem;
    }

    .meta{
      color: var(--muted);
      font-size: .95rem;
    }

    .section-title{
      margin: 0;
      padding: 12px 18px;
      background: var(--soft);
      border-top: 1px solid var(--line);
      border-bottom: 1px solid var(--line);
      font-weight: 800;
      letter-spacing: .2px;
    }

    .q{
      padding: 14px 18px;
      border-bottom: 1px dashed var(--line);
    }

    .q:last-child{
      border-bottom: none;
    }

    .q-head{
      display:flex;
      gap: 12px;
      align-items:flex-start;
    }

    .q-num{
      width: 40px;
      min-width: 40px;
      height: 40px;
      border-radius: 10px;
      background: #fff7ed;
      border: 1px solid #fed7aa;
      color: #9a3412;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
    }

    .q-text{
      font-weight: 700;
    }

    .choices{
      margin-top: 10px;
      padding-left: 52px;
    }

    .choice-item{
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 10px;
    }

    .tf-wrap{
      padding-left: 52px;
      margin-top: 10px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .enum-wrap{
      padding-left: 52px;
      margin-top: 10px;
    }

    .enum-input{
      border-radius: 10px;
      border: 1px solid var(--line);
      padding: 10px 12px;
      width: 100%;
      background: #fff;
    }

    .controls{
      position: sticky;
      bottom: 0;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      border-top: 1px solid var(--line);
      padding: 12px 18px;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content: space-between;
      z-index: 50;
    }

    .score-pill{
      font-weight: 900;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
    }

    .small{
      font-size: .92rem;
      color: var(--muted);
    }

    .result-block{
      display:none;
      margin-top: 10px;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
    }

    .result-block .label{
      font-weight: 900;
      margin-bottom: 6px;
    }

    .ok{
      border-color: rgba(22,163,74,.35) !important;
      background: rgba(22,163,74,.06) !important;
    }

    .bad{
      border-color: rgba(220,38,38,.35) !important;
      background: rgba(220,38,38,.06) !important;
    }

    .explain{
      color: #111827;
      margin: 0;
    }

    .correct{
      color: var(--good);
      font-weight: 800;
    }

    .wrong{
      color: var(--bad);
      font-weight: 800;
    }

    .top-note{
      padding: 12px 18px;
      border-bottom: 1px solid var(--line);
      background: #fff;
    }

    .progress-wrap{
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="paper" id="paper">
    <div class="paper-header">
      <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between">
        <div>
          <span class="badge-subject"><i class="fa-solid fa-book"></i> Araling Panlipunan</span>
          <h4 class="mt-2 mb-1" style="font-weight:900;">Reviewer: Soberaniya at Pagiging Ganap na Estado ng Pilipinas</h4>
          <div class="meta">Student: <strong>Sean Everett Beraquit</strong> • Total Items: <strong>50</strong> • Types: Multiple Choice • Tama o Mali • Enumeration</div>
        </div>

        <div class="text-end">
          <div class="small">Goal: Answer all items before submitting.</div>
          <div class="progress-wrap">
            <div class="small mb-1"><span id="answeredCount">0</span>/50 answered</div>
            <div class="progress" style="height:10px;">
              <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="top-note">
      <div class="alert alert-warning mb-0" role="alert" style="border-radius:12px;">
        <strong>Instructions:</strong> Sagutin ang lahat. Click <strong>Submit</strong> para makuha ang score. Lalabas ang correct answers at explanations.
      </div>
    </div>

    <h5 class="section-title">I. Multiple Choice (1–25)</h5>
    <div id="mcqContainer"></div>

    <h5 class="section-title">II. Tama o Mali (26–40)</h5>
    <div id="tfContainer"></div>

    <h5 class="section-title">III. Enumeration (41–50)</h5>
    <div id="enumContainer"></div>

    <div class="controls">
      <div class="d-flex flex-wrap gap-2 align-items-center">
        <div class="score-pill">
          <i class="fa-solid fa-chart-simple"></i> Score: <span id="score">—</span>/50
        </div>
        <div class="small" id="statusText">Not submitted yet.</div>
      </div>

      <div class="d-flex flex-wrap gap-2">
        <button class="btn btn-outline-secondary" id="btnReset">
          <i class="fa-solid fa-rotate-left"></i> Reset
        </button>
        <button class="btn btn-primary" id="btnSubmit">
          <i class="fa-solid fa-paper-plane"></i> Submit
        </button>
      </div>
    </div>
  </div>

<script>
/* =========================================================
   DATA (Aligned to your AP pages on Soberaniya)
   - 25 MCQ (1–25)
   - 15 True/False (26–40)
   - 10 Enumeration blanks (41–50)
   ========================================================= */

const MCQ = [
  {n:1, q:"Ano ang ibig sabihin ng soberaniya?", choices:[
    "Kayamanan ng bansa","Kakayahan ng bansa na mamuno at magpasunod","Lawak ng teritoryo","Bilang ng mamamayan"
  ], a:"B", exp:"Soberaniya = kapangyarihan ng estado na mamuno at magpasunod sa nasasakupan."},

  {n:2, q:"Alin ang panloob na soberaniya?", choices:[
    "Pakikipagkasundo sa ibang bansa","Kapangyarihan ng pamahalaan sa mga mamamayan","Pagpapadala ng diplomat","Pagtanggap ng tulong panlabas"
  ], a:"B", exp:"Panloob = pamamahala sa loob ng bansa (batas, kaayusan, serbisyo)."},  

  {n:3, q:"Alin ang panlabas na soberaniya?", choices:[
    "Pagpapatupad ng batas sa loob ng bansa","Pakikipag-ugnayan sa ibang bansa bilang malaya","Pagkolekta ng buwis","Pagbibigay ng serbisyo publiko"
  ], a:"B", exp:"Panlabas = kalayaan ng bansa na makipag-ugnayan/makipagkasundo sa ibang bansa."},

  {n:4, q:"Kailan naging ganap na malaya ang Pilipinas?", choices:[
    "Hunyo 12, 1898","Abril 9, 1942","Hulyo 4, 1946","Setyembre 21, 1972"
  ], a:"C", exp:"Hulyo 4, 1946: kinikilalang ganap na kasarinlan bilang republika."},

  {n:5, q:"Alin ang HINDI elemento ng estado?", choices:[
    "Mamamayan","Teritoryo","Wika","Pamahalaan"
  ], a:"C", exp:"Karaniwang apat na elemento: mamamayan, teritoryo, pamahalaan, soberaniya."},

  {n:6, q:"Ano ang tungkulin ng Sandatahang Lakas ng Pilipinas (AFP)?", choices:[
    "Mangolekta ng buwis","Ipagtanggol ang bansa","Magbigay ng edukasyon","Mangasiwa ng eleksyon"
  ], a:"B", exp:"AFP = pagtatanggol ng bansa laban sa banta/panganib."},

  {n:7, q:"Alin ang sangay ng AFP na nagbabantay sa katubigan?", choices:[
    "Philippine Army","Philippine Air Force","Philippine Navy","BFP"
  ], a:"C", exp:"Navy = dagat/katubigan."},

  {n:8, q:"Alin ang ahensyang nangangalaga sa kapaligiran at likas na yaman?", choices:[
    "DFA","DENR","DILG","DOJ"
  ], a:"B", exp:"DENR = Department of Environment and Natural Resources."},

  {n:9, q:"Ano ang karapatan sa pagmamay-ari ng isang bansa?", choices:[
    "Karapatang manghimasok sa ibang bansa","Karapatang ariin ang likas na yaman sa teritoryo","Karapatang humingi ng tulong","Karapatang magpadala ng sundalo"
  ], a:"B", exp:"Kasama rito ang tubig, lupa, mineral, kagubatan, at iba pang likas na yaman sa teritoryo."},

  {n:10, q:"Alin ang halimbawa ng karapatan sa pakikipag-ugnayan?", choices:[
    "Pagpapatupad ng curfew","Pagpapadala ng diplomat","Pagkolekta ng buwis","Pagbibigay ng parusa"
  ], a:"B", exp:"Pakikipag-ugnayan = diplomasya, pagpapadala/pagtanggap ng kinatawan."},

  {n:11, q:"Ano ang tungkulin ng DFA?", choices:[
    "Magpatupad ng batas","Mangasiwa ng eleksyon","Mangasiwa ng ugnayang panlabas","Magbantay sa himpapawid"
  ], a:"C", exp:"DFA = Department of Foreign Affairs; ugnayang panlabas at proteksyon sa Pilipino sa abroad."},

  {n:12, q:"Alin ang karapatan sa kalayaan ng bansa?", choices:[
    "Pumili ng sariling pamahalaan at magpasya para sa bansa","Umangkat ng produkto","Tumanggap ng dayuhan","Magbayad ng buwis"
  ], a:"A", exp:"Kalayaan = walang ibang bansang dapat manghimasok sa pasya ng bansa."},

  {n:13, q:"Ano ang ibig sabihin ng pantay na pribilehiyo?", choices:[
    "Mas mataas ang mayayamang bansa","Pantay ang karapatan ng lahat ng bansa","Mas makapangyarihan ang mauunlad","Mas maraming tulong ang mahihirap"
  ], a:"B", exp:"Sa batas pandaigdig, pantay ang mga bansa sa karapatan at tungkulin."},

  {n:14, q:"Alin ang papel ng mamamayan sa soberaniya?", choices:[
    "Sumunod lamang","Ipagkatiwala lahat sa pamahalaan","Makilahok at sumunod sa batas","Umasa sa ibang bansa"
  ], a:"C", exp:"Ang mamamayan ay mahalaga: pagsunod sa batas at pakikilahok para sa kaayusan at kaunlaran."},

  {n:15, q:"Ano ang tawag sa kakayahan ng estado na magpatupad ng batas?", choices:[
    "Kalayaan","Kapangyarihan","Teritoryo","Diplomasya"
  ], a:"B", exp:"Ito ang kapangyarihan ng estado sa loob ng teritoryo."},

  {n:16, q:"Bakit mahalaga ang soberaniya?", choices:[
    "Para makialam sa ibang bansa","Para mapanatili ang kaayusan at kalayaan","Para mangutang","Para makipagdigma"
  ], a:"B", exp:"Soberaniya ang batayan ng maayos na pamamahala at pagpapanatili ng kalayaan."},

  {n:17, q:"Alin ang simbolo ng soberaniya ng Pilipinas?", choices:[
    "Bandila","Jeepney","Fiesta","Palengke"
  ], a:"A", exp:"Bandila, watawat, salapi, at opisyal na selyo ay simbolo ng soberaniya."},

  {n:18, q:"Ano ang tungkulin ng Philippine Air Force?", choices:[
    "Bantayan ang dagat","Bantayan ang himpapawid","Mangolekta ng buwis","Magbigay ng serbisyo medikal"
  ], a:"B", exp:"Air Force = depensa sa papawirin."},

  {n:19, q:"Ano ang ibig sabihin ng ganap na estado?", choices:[
    "Mayayaman ang mamamayan","Kumpleto ang elemento ng estado","Malawak ang teritoryo","Marami ang sundalo"
  ], a:"B", exp:"Ganap na estado = kumpleto ang elemento: mamamayan, teritoryo, pamahalaan, soberaniya."},

  {n:20, q:"Alin ang HINDI halimbawa ng panlabas na ugnayan?", choices:[
    "Kasunduan","Diplomasya","Pakikipagkalakalan","Pagpapataw ng batas sa loob"
  ], a:"D", exp:"Pagpapatupad ng batas sa loob = panloob na soberaniya."},

  {n:21, q:"Ano ang layunin ng pamahalaan kaugnay ng soberaniya?", choices:[
    "Palitan ang kultura","Panatilihin ang kalayaan at kaayusan","Tularan ang ibang bansa","Umasa sa dayuhan"
  ], a:"B", exp:"Pamahalaan ang nagpapatupad ng batas at naglilingkod para sa kaayusan at kalayaan."},

  {n:22, q:"Ano ang kahulugan ng teritoryo?", choices:[
    "Mga mamamayan","Bahaging sakop ng bansa","Mga batas","Pamahalaan"
  ], a:"B", exp:"Teritoryo = lupain, katubigan, at himpapawid na sakop ng bansa."},

  {n:23, q:"Alin ang nagpapakita ng panloob na soberaniya?", choices:[
    "Pagpirma ng kasunduan","Pagpapatupad ng batas","Pagpapadala ng diplomat","Pakikipagkalakalan"
  ], a:"B", exp:"Panloob = pagpapatupad ng batas at pamamahala sa mamamayan."},

  {n:24, q:"Ano ang papel ng hukbo sa panahon ng panganib?", choices:[
    "Magnegosyo","Magbigay ng edukasyon","Ipagtanggol ang bansa","Magpadala ng diplomat"
  ], a:"C", exp:"Kapag may banta, tumutulong ang hukbo sa depensa at seguridad."},

  {n:25, q:"Alin ang tamang pahayag tungkol sa soberaniya?", choices:[
    "Maaari itong hatiin","Ito ay pansamantala","Ito ay buo at permanente","Ito ay ibinibigay ng ibang bansa"
  ], a:"C", exp:"Sa aralin: soberaniya ay permanente, malawak, di-nasasalin, at lubos."}
];

const TF = [
  {n:26, s:"Ang soberaniya ay kakayahan ng bansa na mamuno sa sarili.", a:"T", exp:"Tama — ito ang kapangyarihan ng estado na mamuno at magpasunod."},
  {n:27, s:"Ang panlabas na soberaniya ay tumutukoy sa kapangyarihan sa loob ng bansa.", a:"M", exp:"Mali — panlabas ay ugnayan sa ibang bansa; panloob ang sa loob."},
  {n:28, s:"Ang Pilipinas ay naging ganap na malaya noong Hulyo 4, 1946.", a:"T", exp:"Tama — ito ang petsang kinikilalang ganap na kasarinlan."},
  {n:29, s:"Ang DENR ay nangangalaga sa likas na yaman.", a:"T", exp:"Tama — DENR ang responsable sa kapaligiran at likas na yaman."},
  {n:30, s:"Ang mamamayan ay walang papel sa soberaniya.", a:"M", exp:"Mali — mahalaga ang mamamayan sa pagsunod sa batas at pakikilahok."},
  {n:31, s:"Ang AFP ay tagapagtanggol ng bansa.", a:"T", exp:"Tama — pangunahing tungkulin ang pagtatanggol sa bansa."},
  {n:32, s:"Ang karapatan sa pagmamay-ari ay kasama ang likas na yaman.", a:"T", exp:"Tama — likas na yaman sa teritoryo ay pag-aari ng estado."},
  {n:33, s:"Ang soberaniya ay maaaring ipasa sa ibang bansa.", a:"M", exp:"Mali — di-nasasalin ang soberaniya."},
  {n:34, s:"Ang DFA ang namamahala sa ugnayang panlabas.", a:"T", exp:"Tama — DFA ang lead agency sa foreign relations."},
  {n:35, s:"Ang teritoryo ay isa sa mga elemento ng estado.", a:"T", exp:"Tama — bahagi ito ng apat na elemento ng estado."},
  {n:36, s:"Ang pantay na pribilehiyo ay nangangahulugang lahat ng bansa ay pantay sa batas.", a:"T", exp:"Tama — pantay ang karapatan/tungkulin ng mga bansa sa batas pandaigdig."},
  {n:37, s:"Ang Philippine Navy ay nagbabantay sa himpapawid.", a:"M", exp:"Mali — Navy ay dagat; Air Force ang himpapawid."},
  {n:38, s:"Ang soberaniya ay mahalaga sa kaayusan ng bansa.", a:"T", exp:"Tama — dito nakabatay ang pagpapatupad ng batas at kaayusan."},
  {n:39, s:"Ang panloob at panlabas na soberaniya ay magkaiba.", a:"T", exp:"Tama — panloob (loob ng bansa) at panlabas (ugnayan sa ibang bansa)."},
  {n:40, s:"Ang pagsunod sa batas ay tungkulin ng mamamayan.", a:"T", exp:"Tama — nakatutulong ito sa pagpapanatili ng kaayusan."}
];

/* Enumeration (10 blanks):
   41–44: 4 elements of a state
   45–47: 3 branches of AFP
   48–50: 3 rights of a free state (from your lesson list)
*/
const ENUM = [
  {n:41, label:"Elemento ng Estado #1", answers:["mamamayan","tao","populasyon"], exp:"Elemento: Mamamayan/Populasyon."},
  {n:42, label:"Elemento ng Estado #2", answers:["teritoryo","sakop na lupain","lupain"], exp:"Elemento: Teritoryo (lupa/katubigan/himpapawid)."},
  {n:43, label:"Elemento ng Estado #3", answers:["pamahalaan","gobyerno"], exp:"Elemento: Pamahalaan/Gobyerno."},
  {n:44, label:"Elemento ng Estado #4", answers:["soberaniya","soberanya","kapangyarihan"], exp:"Elemento: Soberaniya/Kapangyarihan."},

  {n:45, label:"Sangay ng AFP #1", answers:["philippine army","army","hukbong katihan","hukbong katihan ng pilipinas"], exp:"AFP branch: Philippine Army (Katihan)."},
  {n:46, label:"Sangay ng AFP #2", answers:["philippine navy","navy","hukbong dagat","hukbong dagat ng pilipinas"], exp:"AFP branch: Philippine Navy (Dagat)."},
  {n:47, label:"Sangay ng AFP #3", answers:["philippine air force","air force","hukbong himpapawid","hukbong himpapawid ng pilipinas"], exp:"AFP branch: Philippine Air Force (Himpapawid)."},

  {n:48, label:"Karapatan ng Bansang Malaya #1", answers:["karapatan sa kalayaan","kalayaan"], exp:"Karapatan: Kalayaan (independence; di dapat pakialaman ng iba)."},
  {n:49, label:"Karapatan ng Bansang Malaya #2", answers:["karapatan sa pantay na pribilehiyo","pantay na pribilehiyo","pantay na karapatan"], exp:"Karapatan: Pantay na Pribilehiyo (equal status under international law)."},
  {n:50, label:"Karapatan ng Bansang Malaya #3", answers:["karapatan sa saklaw na kapangyarihan","saklaw na kapangyarihan","jurisdiction"], exp:"Karapatan: Saklaw na Kapangyarihan (magpatupad ng batas sa nasasakupan)."}
];

/* =========================================================
   RENDER
   ========================================================= */
const mcqContainer = document.getElementById("mcqContainer");
const tfContainer  = document.getElementById("tfContainer");
const enumContainer= document.getElementById("enumContainer");

function renderMCQ(){
  MCQ.forEach(item=>{
    const div = document.createElement("div");
    div.className = "q";
    div.id = `q${item.n}`;

    div.innerHTML = `
      <div class="q-head">
        <div class="q-num">${item.n}</div>
        <div class="flex-grow-1">
          <div class="q-text">${escapeHtml(item.q)}</div>
          <div class="choices" role="group" aria-label="Choices">
            ${item.choices.map((c,idx)=>{
              const letter = String.fromCharCode(65+idx);
              const name = `mcq_${item.n}`;
              return `
                <label class="choice-item d-flex gap-2 align-items-start">
                  <input class="form-check-input mt-1" type="radio" name="${name}" value="${letter}">
                  <div><strong>${letter}.</strong> ${escapeHtml(c)}</div>
                </label>
              `;
            }).join("")}
          </div>

          <div class="result-block" id="res${item.n}">
            <div class="label" id="lbl${item.n}"></div>
            <p class="explain mb-0" id="exp${item.n}"></p>
          </div>
        </div>
      </div>
    `;
    mcqContainer.appendChild(div);
  });
}

function renderTF(){
  TF.forEach(item=>{
    const div = document.createElement("div");
    div.className = "q";
    div.id = `q${item.n}`;

    div.innerHTML = `
      <div class="q-head">
        <div class="q-num">${item.n}</div>
        <div class="flex-grow-1">
          <div class="q-text">${escapeHtml(item.s)}</div>

          <div class="tf-wrap">
            ${["T","M"].map(v=>`
              <label class="choice-item d-flex gap-2 align-items-center" style="min-width:160px;">
                <input class="form-check-input" type="radio" name="tf_${item.n}" value="${v}">
                <div><strong>${v === "T" ? "Tama" : "Mali"}</strong></div>
              </label>
            `).join("")}
          </div>

          <div class="result-block" id="res${item.n}">
            <div class="label" id="lbl${item.n}"></div>
            <p class="explain mb-0" id="exp${item.n}"></p>
          </div>
        </div>
      </div>
    `;
    tfContainer.appendChild(div);
  });
}

function renderENUM(){
  // Group headings inside Enumeration
  const groups = [
    {title:"41–44: Apat na elemento ng estado", start:41, end:44},
    {title:"45–47: Tatlong sangay ng AFP", start:45, end:47},
    {title:"48–50: Tatlong karapatan ng isang bansang malaya", start:48, end:50},
  ];

  groups.forEach(g=>{
    const block = document.createElement("div");
    block.className = "q";
    block.innerHTML = `
      <div class="q-text" style="padding-left: 52px; font-weight:900; color: var(--accent);">
        <i class="fa-solid fa-list-check"></i> ${escapeHtml(g.title)}
      </div>
    `;
    enumContainer.appendChild(block);

    ENUM.filter(x=>x.n>=g.start && x.n<=g.end).forEach(item=>{
      const div = document.createElement("div");
      div.className = "q";
      div.id = `q${item.n}`;

      div.innerHTML = `
        <div class="q-head">
          <div class="q-num">${item.n}</div>
          <div class="flex-grow-1">
            <div class="q-text">${escapeHtml(item.label)}</div>
            <div class="enum-wrap">
              <input class="enum-input" type="text" id="enum_${item.n}" placeholder="Type your answer here..." />
            </div>

            <div class="result-block" id="res${item.n}">
              <div class="label" id="lbl${item.n}"></div>
              <p class="explain mb-0" id="exp${item.n}"></p>
            </div>
          </div>
        </div>
      `;
      enumContainer.appendChild(div);
    });
  });
}

renderMCQ();
renderTF();
renderENUM();

/* =========================================================
   UTILITIES
   ========================================================= */
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function normalizeAnswer(s){
  return String(s || "")
    .toLowerCase()
    .replace(/[“”"']/g,"")
    .replace(/[^a-z0-9\s\-]/g,"")
    .replace(/\s+/g," ")
    .trim();
}

function getSelected(name){
  const el = document.querySelector(`input[name="${name}"]:checked`);
  return el ? el.value : "";
}

/* =========================================================
   PROGRESS (Answered count)
   ========================================================= */
function calcAnswered(){
  let answered = 0;

  // MCQ answered
  MCQ.forEach(it=>{
    if(getSelected(`mcq_${it.n}`)) answered++;
  });

  // TF answered
  TF.forEach(it=>{
    if(getSelected(`tf_${it.n}`)) answered++;
  });

  // ENUM answered
  ENUM.forEach(it=>{
    const v = document.getElementById(`enum_${it.n}`).value.trim();
    if(v) answered++;
  });

  return answered;
}

function updateProgress(){
  const answered = calcAnswered();
  document.getElementById("answeredCount").textContent = answered;
  const pct = Math.round((answered/50)*100);
  document.getElementById("progressBar").style.width = pct + "%";
}

document.addEventListener("change", (e)=>{
  if(e.target.matches('input[type="radio"]')) updateProgress();
});
document.addEventListener("input", (e)=>{
  if(e.target.matches('input[type="text"]')) updateProgress();
});
updateProgress();

/* =========================================================
   GRADING + FEEDBACK
   ========================================================= */
let submitted = false;

function showResult(n, isCorrect, correctText, explanation){
  const qDiv = document.getElementById(`q${n}`);
  const res  = document.getElementById(`res${n}`);
  const lbl  = document.getElementById(`lbl${n}`);
  const exp  = document.getElementById(`exp${n}`);

  res.style.display = "block";

  if(isCorrect){
    qDiv.classList.remove("bad");
    qDiv.classList.add("ok");
    lbl.innerHTML = `<span class="correct"><i class="fa-solid fa-circle-check"></i> Correct</span> — Answer: <strong>${escapeHtml(correctText)}</strong>`;
  }else{
    qDiv.classList.remove("ok");
    qDiv.classList.add("bad");
    lbl.innerHTML = `<span class="wrong"><i class="fa-solid fa-circle-xmark"></i> Incorrect</span> — Correct Answer: <strong>${escapeHtml(correctText)}</strong>`;
  }

  exp.textContent = explanation;
}

function gradeAll(){
  let score = 0;

  // MCQ
  MCQ.forEach(it=>{
    const user = getSelected(`mcq_${it.n}`);
    const correct = it.a;
    const ok = user === correct;
    if(ok) score++;

    const correctChoiceText = `${correct}. ${it.choices[correct.charCodeAt(0)-65]}`;
    showResult(it.n, ok, correctChoiceText, it.exp);
  });

  // TF
  TF.forEach(it=>{
    const user = getSelected(`tf_${it.n}`);
    const ok = user === it.a;
    if(ok) score++;

    const correctText = it.a === "T" ? "Tama (T)" : "Mali (M)";
    showResult(it.n, ok, correctText, it.exp);
  });

  // ENUM
  ENUM.forEach(it=>{
    const userRaw = document.getElementById(`enum_${it.n}`).value;
    const user = normalizeAnswer(userRaw);

    const ok = it.answers.some(ans => normalizeAnswer(ans) === user);
    if(ok) score++;

    const correctText = it.answers[0]; // primary display
    showResult(it.n, ok, correctText, it.exp);
  });

  document.getElementById("score").textContent = score;
  document.getElementById("statusText").textContent = "Submitted. Answers + explanations are now shown.";
  return score;
}

/* =========================================================
   SUBMIT (Confirm via SweetAlert2)
   ========================================================= */
document.getElementById("btnSubmit").addEventListener("click", async ()=>{
  if(submitted){
    Swal.fire({
      icon: "info",
      title: "Already submitted",
      text: "You already submitted. Press Reset if you want to answer again."
    });
    return;
  }

  const answered = calcAnswered();
  const remaining = 50 - answered;

  const res = await Swal.fire({
    icon: "question",
    title: "Submit your answers?",
    html: remaining > 0
      ? `You still have <strong>${remaining}</strong> unanswered item(s).<br>Do you want to submit anyway?`
      : `All items answered. Ready to submit?`,
    showCancelButton: true,
    confirmButtonText: "Yes, submit",
    cancelButtonText: "Cancel",
    confirmButtonColor: "#0d6efd",
  });

  if(!res.isConfirmed) return;

  submitted = true;
  const score = gradeAll();

  Swal.fire({
    icon: "success",
    title: "Done!",
    html: `Score: <strong>${score}/50</strong>`,
    confirmButtonText: "OK"
  });

  // Scroll to top so score is visible
  window.scrollTo({ top: 0, behavior: "smooth" });
});

/* =========================================================
   RESET
   ========================================================= */
document.getElementById("btnReset").addEventListener("click", async ()=>{
  const res = await Swal.fire({
    icon: "warning",
    title: "Reset all answers?",
    text: "This will clear your answers and hide results.",
    showCancelButton: true,
    confirmButtonText: "Yes, reset",
    cancelButtonText: "Cancel"
  });
  if(!res.isConfirmed) return;

  submitted = false;

  // clear radios
  document.querySelectorAll('input[type="radio"]').forEach(r=> r.checked = false);

  // clear text
  ENUM.forEach(it=>{
    const el = document.getElementById(`enum_${it.n}`);
    if(el) el.value = "";
  });

  // remove styles & hide result blocks
  for(let i=1;i<=50;i++){
    const qDiv = document.getElementById(`q${i}`);
    const resDiv = document.getElementById(`res${i}`);
    if(qDiv){
      qDiv.classList.remove("ok","bad");
    }
    if(resDiv){
      resDiv.style.display = "none";
    }
  }

  document.getElementById("score").textContent = "—";
  document.getElementById("statusText").textContent = "Not submitted yet.";
  updateProgress();

  Swal.fire({ icon:"success", title:"Reset complete!", timer: 900, showConfirmButton:false });
});
</script>

</body>
</html>
