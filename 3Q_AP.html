<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AP Reviewer ‚Äì Soberaniya at Pagiging Ganap na Estado (Interactive)</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- LineIcons -->
  <link rel="stylesheet" href="https://cdn.lineicons.com/4.0/lineicons.css">

  <style>
    :root{
      --ink:#111827; --paper:#f9fafb; --card:#ffffff;
      --accent:#14b8a6; --accent-2:#0d9488;
      --ok:#10b981; --bad:#ef4444; --warn:#f59e0b;
    }
    body{ background:var(--paper); color:var(--ink); font-family:'Poppins',sans-serif; }
    .dark-mode{ background:#111827; color:#f9fafb; }
    .container{ max-width:960px; }
    h1,h2{ font-weight:700; }
    .section-title{ margin-top:2rem; border-left:6px solid var(--accent); padding-left:.6rem; }
    .question{ margin-bottom:1rem; padding:1rem; border:1px solid #e5e7eb; background:var(--card);}
    .dark-mode .question{ background:#1f2937; border-color:#374151; }
    .qhead{ font-weight:600; margin-bottom:.5rem; }
    .options button{
      display:block; width:100%; text-align:left; border-radius:0; padding:.75rem;
      border:1px solid #d1d5db; background:#f9fafb; color:var(--ink); margin:.35rem 0;
    }
    .options button.selected{ background:var(--accent) !important; color:#fff !important; font-weight:600; }
    .dark-mode .options button{ background:#374151; color:#f9fafb; border-color:#4b5563; }
    .dark-mode .options button.selected{ background:var(--accent-2) !important; }
    .feedback{ margin-top:.6rem; padding:.6rem .75rem; font-size:.95rem; }
    .correct{ background:#ecfdf5; border-left:4px solid var(--ok); }
    .incorrect{ background:#fef2f2; border-left:4px solid var(--bad); }
    .unanswered{ background:#fffbeb; border-left:4px solid var(--warn); }
    .exp{ display:none; margin-top:.55rem; border-top:1px dashed #d1d5db; padding-top:.55rem; }
    .exp-toggle{ margin-top:.35rem; border:none; background:transparent; color:var(--accent-2); font-weight:700; }
    .scorecard{
      display:none; border:1px solid #e5e7eb; background:#ecfeff;
      border-left:6px solid var(--accent); padding:1rem; margin-bottom:1rem;
    }
    .dark-mode .scorecard{ background:#04383a; border-color:#11484b; }
    .score-stars{ font-size:1.5rem; }
    .submit-btn,.reset-btn{ width:100%; border-radius:0; padding:.85rem; font-weight:800; }
    .submit-btn{ background:var(--accent); border:1px solid var(--accent-2); color:#fff; }
    .reset-btn{ background:#111827; color:#fff; }
    .dark-toggle{ position:fixed; bottom:1rem; right:1rem; border-radius:0; }
    .id-input{
      width:100%;
      border-radius:0;
      padding:.7rem .75rem;
      border:1px solid #d1d5db;
      background:#fff;
    }
    .dark-mode .id-input{
      background:#111827;
      color:#f9fafb;
      border-color:#4b5563;
    }
    .tag{
      display:inline-block;
      font-size:.85rem;
      padding:.15rem .55rem;
      border-radius:999px;
      background:#e0f2fe;
      border:1px solid #bae6fd;
      margin-left:.35rem;
    }
    .dark-mode .tag{ background:#0b2a3a; border-color:#1b4156; color:#dbeafe; }
  </style>
</head>
<body>

<div class="container my-4">
  <h1 class="text-center"><i class="lni lni-graduation"></i> AP Interactive Reviewer</h1>
  <p class="text-center text-muted">Soberaniya at Pagiging Ganap na Estado ‚Ä¢ For Sean Everett Beraquit ‚Ä¢ 50 Items</p>

  <!-- Scorecard -->
  <div id="scorecard" class="scorecard">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <div class="fw-bold">Total Score: <span id="totalScore">0</span> / 50</div>
        <div id="scoreMsg" class="text-muted"></div>
      </div>
      <div id="starRow" class="score-stars"></div>
    </div>
  </div>

  <!-- Instructions -->
  <div class="instructions p-3 mb-4 border">
    <p class="mb-2"><b>How to Answer:</b></p>
    <ul class="mb-0">
      <li>Tap the best choice for <b>Multiple Choice</b> and <b>Tama o Mali</b>.</li>
      <li>Type your answer for <b>Identification/Enumeration</b> (minor spaces/case are OK).</li>
      <li>Click <b>Submit</b> to see score and explanations (you‚Äôll be asked to confirm).</li>
    </ul>
  </div>

  <!-- ===========================
       PART I ‚Äì Multiple Choice (1‚Äì25)
       =========================== -->
  <h2 class="section-title h5">Part I ‚Äì Multiple Choice (1‚Äì25) <span class="tag">25 pts</span></h2>
  <div id="mcqArea"></div>

  <!-- ===========================
       PART II ‚Äì Tama o Mali (26‚Äì40)
       =========================== -->
  <h2 class="section-title h5">Part II ‚Äì Tama o Mali (26‚Äì40) <span class="tag">15 pts</span></h2>
  <div id="tfArea"></div>

  <!-- ===========================
       PART III ‚Äì Identification/Enumeration (41‚Äì50)
       =========================== -->
  <h2 class="section-title h5">Part III ‚Äì Identification / Enumeration (41‚Äì50) <span class="tag">10 pts</span></h2>
  <div id="idArea"></div>

  <!-- Actions -->
  <div class="my-4">
    <button class="submit-btn btn" id="submitBtn">Submit</button>
    <div class="mt-2"></div>
    <button class="reset-btn btn" id="resetBtn">Retake Quiz</button>
  </div>
</div>

<button class="btn btn-dark dark-toggle" onclick="toggleDark()">üåô</button>

<script>
/* =========================================================
   AP REVIEWER DATA (50 ITEMS)
   Styling/logic matches your CLVE template.
   ========================================================= */

/* ---------- Part I: MCQ 1‚Äì25 ---------- */
const mcq = [
  {id:"q1",  q:"1) Ano ang ibig sabihin ng soberaniya?", A:"Kayamanan ng bansa", B:"Kakayahan ng bansa na mamuno at magpasunod", C:"Lawak ng teritoryo", D:"Bilang ng mamamayan", ans:"B",
   exp:"Soberaniya = sukdulang kapangyarihan ng estado na mamuno at magpasunod sa nasasakupan."},

  {id:"q2",  q:"2) Alin ang panloob na soberaniya?", A:"Pakikipagkasundo sa ibang bansa", B:"Kapangyarihan ng pamahalaan sa mga mamamayan", C:"Pagpapadala ng diplomat", D:"Pagtanggap ng tulong panlabas", ans:"B",
   exp:"Panloob (internal) = kapangyarihan ng pamahalaan sa loob ng teritoryo (batas, kaayusan, serbisyo)."},
  {id:"q3",  q:"3) Alin ang panlabas na soberaniya?", A:"Pagpapatupad ng batas sa loob ng bansa", B:"Kalayaan na makipag-ugnayan sa ibang bansa bilang malaya", C:"Pagkolekta ng buwis", D:"Pagbibigay ng serbisyo publiko", ans:"B",
   exp:"Panlabas (external) = kalayaang makipag-ugnayan/makipagkasundo sa ibang bansa."},
  {id:"q4",  q:"4) Kailan kinikilalang naging ganap na malaya ang Pilipinas?", A:"Hunyo 12, 1898", B:"Abril 9, 1942", C:"Hulyo 4, 1946", D:"Setyembre 21, 1972", ans:"C",
   exp:"Hulyo 4, 1946 ang petsang kinikilalang ganap na kasarinlan (kalayaan) ng Pilipinas."},
  {id:"q5",  q:"5) Alin ang HINDI elemento ng estado?", A:"Mamamayan", B:"Teritoryo", C:"Wika", D:"Pamahalaan", ans:"C",
   exp:"Karaniwang apat: mamamayan, teritoryo, pamahalaan, soberaniya. Hindi kasama ang ‚Äúwika‚Äù bilang elemento."},

  {id:"q6",  q:"6) Ano ang pangunahing tungkulin ng Sandatahang Lakas ng Pilipinas (AFP)?", A:"Mangolekta ng buwis", B:"Ipagtanggol ang bansa", C:"Magbigay ng edukasyon", D:"Mangasiwa ng eleksyon", ans:"B",
   exp:"AFP = pagtatanggol sa bansa at pagprotekta sa mamamayan."},
  {id:"q7",  q:"7) Alin ang sangay ng AFP na nagbabantay sa katubigan?", A:"Philippine Army", B:"Philippine Air Force", C:"Philippine Navy", D:"BFP", ans:"C",
   exp:"Philippine Navy ang nagbabantay sa dagat/katubigan."},
  {id:"q8",  q:"8) Aling ahensya ang nangangalaga sa kapaligiran at likas na yaman?", A:"DFA", B:"DENR", C:"DILG", D:"DOJ", ans:"B",
   exp:"DENR ang nangangalaga sa kapaligiran at likas na yaman."},
  {id:"q9",  q:"9) Ang karapatan sa pagmamay-ari ng bansa ay tumutukoy sa‚Ä¶", A:"Karapatang manghimasok sa ibang bansa", B:"Karapatang ariin at pangalagaan ang likas na yaman sa teritoryo", C:"Karapatang humingi ng tulong", D:"Karapatang magpadala ng sundalo", ans:"B",
   exp:"Kasama rito ang tubig, lupa, mineral, kagubatan, hayop, at iba pang yaman sa teritoryo."},
  {id:"q10", q:"10) Alin ang halimbawa ng karapatan sa pakikipag-ugnayan?", A:"Pagpapatupad ng curfew", B:"Pagpapadala/pagtanggap ng diplomat", C:"Pagkolekta ng buwis", D:"Pagbibigay ng parusa", ans:"B",
   exp:"Pakikipag-ugnayan = diplomasya, pagpapadala/pagtanggap ng kinatawan sa ibang bansa."},

  {id:"q11", q:"11) Ano ang tungkulin ng DFA?", A:"Magpatupad ng batas", B:"Mangasiwa ng eleksyon", C:"Mangasiwa ng ugnayang panlabas", D:"Magbantay sa himpapawid", ans:"C",
   exp:"DFA = ugnayang panlabas at pangangalaga sa Pilipinong nasa ibang bansa."},
  {id:"q12", q:"12) Ano ang karapatan sa kalayaan ng bansa?", A:"Pumili ng sariling pamahalaan at magpasya para sa bansa", B:"Umangkat ng produkto", C:"Tumanggap ng dayuhan", D:"Magbayad ng buwis", ans:"A",
   exp:"Kalayaan = walang ibang bansang dapat manghimasok sa desisyon ng bansa."},
  {id:"q13", q:"13) Ano ang kahulugan ng pantay na pribilehiyo?", A:"Mas mataas ang mayayamang bansa", B:"Pantay ang karapatan at tungkulin ng mga bansa", C:"Mas makapangyarihan ang mauunlad", D:"Mas maraming tulong ang mahihirap", ans:"B",
   exp:"Sa batas pandaigdig, pantay ang mga bansa sa karapatan, tungkulin, at pribilehiyo."},
  {id:"q14", q:"14) Alin ang nagpapakita ng mabuting papel ng mamamayan sa soberaniya?", A:"Sumunod lang kahit mali", B:"Umasa sa dayuhan", C:"Sumunod sa batas at makilahok sa kaayusan", D:"Balewalain ang batas", ans:"C",
   exp:"Ang pagsunod sa batas at pakikilahok ay tumutulong sa kaayusan at lakas ng bansa."},
  {id:"q15", q:"15) Ano ang ibig sabihin ng ganap na estado?", A:"Mayaman ang mamamayan", B:"Kumpleto ang elemento ng estado", C:"Malawak ang teritoryo", D:"Marami ang sundalo", ans:"B",
   exp:"Ganap na estado = kumpleto ang mamamayan, teritoryo, pamahalaan, at soberaniya."},

  {id:"q16", q:"16) Alin ang HINDI halimbawa ng panlabas na ugnayan?", A:"Kasunduan", B:"Diplomasya", C:"Pakikipagkalakalan", D:"Pagpapatupad ng batas sa loob", ans:"D",
   exp:"Pagpapatupad ng batas sa loob ay panloob na soberaniya."},
  {id:"q17", q:"17) Alin ang simbolo ng soberaniya/pagkamakapangyarihan ng bansa?", A:"Watawat/Bandila", B:"Palengke", C:"Jeepney", D:"Fiesta", ans:"A",
   exp:"Bandila/watawat, salapi, at opisyal na selyo ay simbolo ng soberaniya."},
  {id:"q18", q:"18) Ano ang tungkulin ng Philippine Air Force?", A:"Bantayan ang dagat", B:"Bantayan ang himpapawid", C:"Mangolekta ng buwis", D:"Magbigay ng serbisyo medikal", ans:"B",
   exp:"Air Force = depensa sa papawirin/himpapawid."},
  {id:"q19", q:"19) Ano ang kahulugan ng teritoryo?", A:"Mga mamamayan", B:"Bahaging sakop ng bansa", C:"Mga batas", D:"Pamahalaan", ans:"B",
   exp:"Teritoryo = lupa, katubigan, at himpapawid na sakop ng bansa."},
  {id:"q20", q:"20) Alin ang nagpapakita ng panloob na soberaniya?", A:"Pagpirma ng kasunduan", B:"Pagpapatupad ng batas", C:"Pagpapadala ng diplomat", D:"Pakikipagkalakalan", ans:"B",
   exp:"Panloob = pagpapatupad ng batas at pamamahala sa loob ng bansa."},

  {id:"q21", q:"21) Ano ang layunin ng pamahalaan kaugnay ng soberaniya?", A:"Palitan ang kultura", B:"Panatilihin ang kaayusan at kalayaan", C:"Umasa sa ibang bansa", D:"Iwasan ang batas", ans:"B",
   exp:"Pamahalaan ang nagpapanatili ng kaayusan, nagpapatupad ng batas, at naglilingkod sa mamamayan."},
  {id:"q22", q:"22) Ano ang tungkulin ng hukbo sa panahon ng panganib?", A:"Magnegosyo", B:"Magbigay ng edukasyon", C:"Ipagtanggol ang bansa", D:"Magpadala ng diplomat", ans:"C",
   exp:"Hukbo/AFP ang tumutulong sa depensa at seguridad ng bansa."},
  {id:"q23", q:"23) Alin ang tamang pahayag tungkol sa soberaniya?", A:"Maaari itong hatiin-hatiin", B:"Ito ay pansamantala lamang", C:"Ito ay buo at lubos", D:"Ito ay ibinibigay ng ibang bansa", ans:"C",
   exp:"Sa aralin: ang soberaniya ay lubos (buo) at hindi dapat hinahati o isinasalin."},
  {id:"q24", q:"24) Alin ang katangian ng soberaniya na ibig sabihin ay hindi ito naipapasa sa ibang bansa?", A:"Permanente", B:"Malawak", C:"Di-nasasalin", D:"Lubos", ans:"C",
   exp:"Di-nasasalin = hindi maililipat sa ibang bansa ang kapangyarihan ng estado."},
  {id:"q25", q:"25) Bakit mahalaga ang soberaniya sa isang bansa?", A:"Para makialam sa ibang bansa", B:"Para mapanatili ang kaayusan at kalayaan", C:"Para magyabang", D:"Para mag-away", ans:"B",
   exp:"Soberaniya ang batayan ng kaayusan, pagpapatupad ng batas, at pagpapanatili ng kalayaan."}
];

/* ---------- Part II: True/False 26‚Äì40 ---------- */
const tf = [
  {id:"q26", q:"26) Ang soberaniya ay kakayahan ng bansa na mamuno sa sarili.", ans:"T", exp:"Tama ‚Äî ito ang sukdulang kapangyarihan ng estado."},
  {id:"q27", q:"27) Ang panlabas na soberaniya ay tumutukoy sa kapangyarihan sa loob ng bansa.", ans:"M", exp:"Mali ‚Äî panlabas ay ugnayan sa ibang bansa; panloob ang sa loob."},
  {id:"q28", q:"28) Ang Pilipinas ay kinikilalang ganap na malaya noong Hulyo 4, 1946.", ans:"T", exp:"Tama ‚Äî ito ang petsa ng ganap na kasarinlan."},
  {id:"q29", q:"29) Ang DENR ay nangangalaga sa likas na yaman.", ans:"T", exp:"Tama ‚Äî DENR ang may tungkulin sa kalikasan at likas na yaman."},
  {id:"q30", q:"30) Ang mamamayan ay walang papel sa soberaniya.", ans:"M", exp:"Mali ‚Äî mahalaga ang mamamayan sa pagsunod sa batas at pakikilahok."},

  {id:"q31", q:"31) Ang AFP ang tagapagtanggol ng bansa.", ans:"T", exp:"Tama ‚Äî AFP ang pangunahing tagapagtanggol."},
  {id:"q32", q:"32) Kasama sa karapatan sa pagmamay-ari ang likas na yaman sa teritoryo.", ans:"T", exp:"Tama ‚Äî ari-arian/yaman sa teritoryo ay saklaw ng estado."},
  {id:"q33", q:"33) Ang soberaniya ay maaaring ipasa sa ibang bansa.", ans:"M", exp:"Mali ‚Äî di-nasasalin ang soberaniya."},
  {id:"q34", q:"34) Ang DFA ang namamahala sa ugnayang panlabas.", ans:"T", exp:"Tama ‚Äî DFA ang lead agency sa foreign affairs."},
  {id:"q35", q:"35) Ang teritoryo ay isa sa mga elemento ng estado.", ans:"T", exp:"Tama ‚Äî bahagi ito ng apat na elemento."},

  {id:"q36", q:"36) Ang pantay na pribilehiyo ay nangangahulugang pantay ang bansa sa batas pandaigdig.", ans:"T", exp:"Tama ‚Äî pantay ang karapatan/tungkulin ng mga bansa."},
  {id:"q37", q:"37) Ang Philippine Navy ay nagbabantay sa himpapawid.", ans:"M", exp:"Mali ‚Äî Navy ay dagat; Air Force ang himpapawid."},
  {id:"q38", q:"38) Mahalaga ang soberaniya para sa kaayusan ng bansa.", ans:"T", exp:"Tama ‚Äî dito nakabatay ang pagpapatupad ng batas."},
  {id:"q39", q:"39) Magkaiba ang panloob at panlabas na soberaniya.", ans:"T", exp:"Tama ‚Äî panloob (loob) at panlabas (ugnayan sa iba)."},
  {id:"q40", q:"40) Ang pagsunod sa batas ay tungkulin ng mamamayan.", ans:"T", exp:"Tama ‚Äî tumutulong ito sa kaayusan at kaunlaran."}
];

/* ---------- Part III: Identification / Enumeration 41‚Äì50 ---------- */
const idItems = [
  // Elements of a state
  {id:"q41", q:"41) Elemento ng Estado #1 (tao / populasyon)", accepted:["mamamayan","tao","populasyon"], hint:"mamamayan", exp:"Apat na elemento: mamamayan, teritoryo, pamahalaan, soberaniya."},
  {id:"q42", q:"42) Elemento ng Estado #2 (sakop na bahagi ng bansa)", accepted:["teritoryo","sakop na lupain","lupain","katubigan at himpapawid"], hint:"teritoryo", exp:"Teritoryo = lupa, katubigan, at himpapawid na sakop ng bansa."},
  {id:"q43", q:"43) Elemento ng Estado #3", accepted:["pamahalaan","gobyerno"], hint:"pamahalaan", exp:"Pamahalaan/Gobyerno ang nagpapatupad ng batas at naglilingkod."},
  {id:"q44", q:"44) Elemento ng Estado #4", accepted:["soberaniya","soberanya","kapangyarihan"], hint:"soberaniya", exp:"Soberaniya = sukdulang kapangyarihan ng estado."},

  // Branches of AFP
  {id:"q45", q:"45) Sangay ng AFP #1 (katihan)", accepted:["philippine army","army","hukbong katihan","hukbong katihan ng pilipinas"], hint:"philippine army", exp:"Army = katihan."},
  {id:"q46", q:"46) Sangay ng AFP #2 (dagat)", accepted:["philippine navy","navy","hukbong dagat","hukbong dagat ng pilipinas"], hint:"philippine navy", exp:"Navy = dagat."},
  {id:"q47", q:"47) Sangay ng AFP #3 (himpapawid)", accepted:["philippine air force","air force","hukbong himpapawid","hukbong himpapawid ng pilipinas"], hint:"philippine air force", exp:"Air Force = himpapawid."},

  // Rights of a free state (from your lesson list)
  {id:"q48", q:"48) Karapatan ng bansang malaya #1", accepted:["karapatan sa kalayaan","kalayaan"], hint:"karapatan sa kalayaan", exp:"Kalayaan = walang ibang bansang dapat manghimasok sa pasya ng bansa."},
  {id:"q49", q:"49) Karapatan ng bansang malaya #2", accepted:["karapatan sa pantay na pribilehiyo","pantay na pribilehiyo","pantay na karapatan"], hint:"karapatan sa pantay na pribilehiyo", exp:"Pantay na pribilehiyo = pantay ang mga bansa sa batas pandaigdig."},
  {id:"q50", q:"50) Karapatan ng bansang malaya #3", accepted:["karapatan sa saklaw na kapangyarihan","saklaw na kapangyarihan","jurisdiction","hurisdiksyon"], hint:"karapatan sa saklaw na kapangyarihan", exp:"Saklaw na kapangyarihan = karapatang ipatupad ang batas sa nasasakupan."}
];

/* =========================================================
   RENDER
   ========================================================= */
const mcqArea = document.getElementById("mcqArea");
const tfArea  = document.getElementById("tfArea");
const idArea  = document.getElementById("idArea");

function renderMCQ(){
  mcq.forEach(item=>{
    mcqArea.insertAdjacentHTML("beforeend", `
      <div class="question" id="${item.id}">
        <div class="qhead">${item.q}</div>
        <div class="options">
          <button data-answer="A">A) ${item.A}</button>
          <button data-answer="B">B) ${item.B}</button>
          <button data-answer="C">C) ${item.C}</button>
          <button data-answer="D">D) ${item.D}</button>
        </div>
        <div class="feedback"></div>
      </div>
    `);
  });
}

function renderTF(){
  tf.forEach(item=>{
    tfArea.insertAdjacentHTML("beforeend", `
      <div class="question" id="${item.id}">
        <div class="qhead">${item.q}</div>
        <div class="options">
          <button data-answer="T">Tama</button>
          <button data-answer="M">Mali</button>
        </div>
        <div class="feedback"></div>
      </div>
    `);
  });
}

function renderID(){
  idItems.forEach(item=>{
    idArea.insertAdjacentHTML("beforeend", `
      <div class="question" id="${item.id}">
        <div class="qhead">${item.q}</div>
        <input class="id-input" type="text" placeholder="Type your answer"/>
        <div class="feedback"></div>
      </div>
    `);
  });
}

renderMCQ(); renderTF(); renderID();

/* =========================================================
   MCQ/TF selection logic (same as CLVE)
   ========================================================= */
document.querySelectorAll('.options button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const parent = btn.closest('.question');
    parent.dataset.selected = btn.dataset.answer;
    parent.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
  });
});

/* =========================================================
   Helpers (same philosophy as CLVE)
   ========================================================= */
function norm(s){
  return (s||"")
    .toLowerCase()
    .replace(/\s+/g," ")
    .replace(/[.,!?;:()"']/g,"")
    .trim();
}
function isMatch(user, acceptedList){
  const u = norm(user);
  return acceptedList.some(a => norm(a) === u);
}
function toggleExp(id, btn){
  const exp = document.getElementById(id);
  if(!exp) return;
  if(exp.style.display === "block"){
    exp.style.display="none"; btn.innerHTML="Show Explanation";
  }else{
    exp.style.display="block"; btn.innerHTML="Hide Explanation";
  }
}

/* =========================================================
   Submit (confirm) + scoring + explanations
   ========================================================= */
document.getElementById('submitBtn').addEventListener('click',()=>{
  const ok = confirm("Submit your answers now? You will see your score and explanations.");
  if(!ok) return;

  let score = 0;

  // Grade MCQ
  mcq.forEach(item=>{
    const el = document.getElementById(item.id);
    const fb = el.querySelector('.feedback'); fb.innerHTML="";
    const sel = el.dataset.selected;

    let statusHTML="";
    if(!sel) statusHTML = `<div class="unanswered">‚ö†Ô∏è Not answered</div>`;
    else if(sel === item.ans){ statusHTML = `<div class="correct">‚úÖ Correct</div>`; score++; }
    else statusHTML = `<div class="incorrect">‚ùå Incorrect (Correct: ${item.ans})</div>`;

    const expId = `${item.id}-exp`;
    fb.innerHTML = `${statusHTML}
      <button class="exp-toggle" onclick="toggleExp('${expId}',this)">Show Explanation</button>
      <div class="exp" id="${expId}">${item.exp}</div>`;
  });

  // Grade TF
  tf.forEach(item=>{
    const el = document.getElementById(item.id);
    const fb = el.querySelector('.feedback'); fb.innerHTML="";
    const sel = el.dataset.selected;

    let statusHTML="";
    if(!sel) statusHTML = `<div class="unanswered">‚ö†Ô∏è Not answered</div>`;
    else if(sel === item.ans){ statusHTML = `<div class="correct">‚úÖ Correct</div>`; score++; }
    else{
      const label = item.ans === "T" ? "Tama" : "Mali";
      statusHTML = `<div class="incorrect">‚ùå Incorrect (Correct: ${label})</div>`;
    }

    const expId = `${item.id}-exp`;
    fb.innerHTML = `${statusHTML}
      <button class="exp-toggle" onclick="toggleExp('${expId}',this)">Show Explanation</button>
      <div class="exp" id="${expId}">${item.exp}</div>`;
  });

  // Grade ID
  idItems.forEach(item=>{
    const el = document.getElementById(item.id);
    const input = el.querySelector('input');
    const fb = el.querySelector('.feedback'); fb.innerHTML="";
    const user = input ? input.value : "";

    let statusHTML="";
    if(!user || !user.trim()){
      statusHTML = `<div class="unanswered">‚ö†Ô∏è Not answered</div>`;
    }else if(isMatch(user, item.accepted)){
      statusHTML = `<div class="correct">‚úÖ Correct</div>`;
      score++;
    }else{
      statusHTML = `<div class="incorrect">‚ùå Incorrect (Possible answer: <b>${item.hint}</b>)</div>`;
    }

    const expId = `${item.id}-exp`;
    fb.innerHTML = `${statusHTML}
      <button class="exp-toggle" onclick="toggleExp('${expId}',this)">Show Explanation</button>
      <div class="exp" id="${expId}">${item.exp}</div>`;
  });

  // Scorecard (same star logic)
  document.getElementById('totalScore').textContent = score;

  let stars = Math.floor(score/10);
  document.getElementById('starRow').textContent = "‚òÖ".repeat(stars) + "‚òÜ".repeat(5-stars);

  let msg = score>=45 ? "üåü Excellent! Very strong understanding."
          : score>=35 ? "üëç Great job! Just review a few items."
          : score>=25 ? "üôÇ Good effort! Practice more for mastery."
          : "üí™ Keep practicing! Read explanations and try again.";
  document.getElementById('scoreMsg').textContent = msg;

  document.getElementById('scorecard').style.display = "block";
  window.scrollTo({top:0,behavior:'smooth'});
});

/* =========================================================
   Reset
   ========================================================= */
document.getElementById('resetBtn').addEventListener('click',()=>{
  if(!confirm("Retake quiz? This will clear your answers.")) return;

  document.querySelectorAll('.question').forEach(q=>{
    delete q.dataset.selected;
    q.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
    const fb = q.querySelector('.feedback'); if(fb) fb.innerHTML="";
    const inp = q.querySelector('input'); if(inp) inp.value="";
  });

  document.getElementById('scorecard').style.display = "none";
});

/* =========================================================
   Dark Mode
   ========================================================= */
function toggleDark(){ document.body.classList.toggle("dark-mode"); }
</script>

</body>
</html>
